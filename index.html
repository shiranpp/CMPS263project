<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>When and Where can i buy a house in Beijing</title>
</head>
<link rel="stylesheet" href="css/tether.min.css">
<link rel="stylesheet" href="css/bootstrap.min.css">
<style>
    a {
        font-family: Helvetica, sans-serif;
        font-size: 16px;
        color: #000;
    }

    h1 {
        font-family: Helvetica, sans-serif;
        font-size: 28px;
        color: #000;
    }

    h2 {
        font-family: Helvetica, sans-serif;
        font-size: 18px;
        color: #000;
    }

    svg.district {
        position: absolute;
        top: 240px;
        left: 0px;
        height: 600px;
        width: 800px;
        bottom: 100px;
        margin-left: auto;
        margin-right: 2px;
        right: 0;
        border-style: solid;
        border-color: #449999;
        border-width: 1px;
    }

    div.title {
        height: 200px;
        padding: 4px;
        background-color: #ddd;
        border-bottom: 2px solid #ccc;
        padding: 4px;
    }

    .tooltip {
        position: absolute;
        font-family: simsun;
        font-size: 16px;
        text-align: center;
        padding: 1em;
        background: #903030;
        border: 1px solid #dddddd;
        color: #ffffff;
    }
</style>
<script type="text/javascript" src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="js/tether.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
<script type="text/javascript" src="js/chroma.min.js"></script>
<body>
<div class="title">
    <div class="container">
        <h1 style="text-align:center">When and Where can i buy a house in Beijing ?</h1>
        <h2 style="text-align:center">Ziqiang Wang, Ran(Ryan) Shi, Zhuo Wang</h2>
    </div>
</div>
<br>
<div class="map" id="map">
    <div class="btn-group">
        <button id="wagetype0" type="button" class="btn btn-primary" style="background-color: #0bb7ba" onclick="">Job title(职位):</button>
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="#">Tablet</a></li>
            <li><a href="#">Smartphone</a></li>
        </ul>
    </div>
    <br>
    <br>
    <a>OR(或)</a>
    <br>
    <br>
    <div class="input-group">
        <button id="wagetype1" type="button" class="btn btn-primary">Fixed wages/Month(每月固定工资):¥</button>
        <div class="test">
            <input id="wage" type="number" class="form-control" name="msg" placeholder="0"
                   style="width:200px;//宽度height=20px;//高度">
        </div>
    </div>
    <br>
    <a>And(和)</a>
    <br>
    <br>
    <div class="btn-group">
        <button type="button" class="btn btn-primary">Apartment area type(房屋面积类型):</button>
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="#">Tablet</a></li>
            <li><a href="#">Smartphone</a></li>
        </ul>
    </div>
</div>
<script>
    //Util
    var tomoney = function (m, n, x) {
        var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\.' : '$') + ')';
        return m.toFixed(Math.max(0, ~~n)).replace(new RegExp(re, 'g'), '$&,');
    };
    //Color Scaling range
    var scale = chroma.scale(['#1FB469', '#A94B36']);

    //Graph Setting
    var width = 800;
    var height = 600;
    var center = [116.41667, 40.21667];
    //div width
    var m_width = $("#map").width();


    var district;

    var tooltip = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0.0);

    //Wage
    var wage;
    var avgwage=0;
    var wagetype=0;

    function changeWage(i) {
        if(i!=wagetype){
            $("#wagetype"+wagetype.toString()).css("background-color","#025aa5")
        }else


    }







    //    Draw map
    //    -----------------------------------------------------------------------------------------------
    var projection = d3.geo.mercator()
        .center(center)
        .scale(10000)
        .translate([width / 2, height / 2]);

    var path = d3.geo.path()
        .projection(projection);


    var svg = d3.select("#map").append("svg")
        .attr("class", "district")
        .attr("preserveAspectRatio", "xMidYMid")
        .attr("viewBox", "0 0 " + width + " " + height)
        .attr("width", m_width)
        .attr("height", m_width * height / width);

    svg.append("rect")
        .attr("class", "background")
        .attr("width", width)
        .attr("height", height)
        .attr("fill", "white")
        .on("click", district_clicked);


    var g = svg.append("g");


    d3.json("beijing1.json", function (error, root) {

        g.append("g")
            .attr("id", "district")
            .selectAll("path")
            .data(root.features)
            .enter()
            .append("path")
            .attr("id", function (d) {
                return d.id;
            })
            .attr("stroke", "#000")
            .attr("stroke-width", 0.5)
            .attr("fill", function (d, i) {
                if (d.properties.avg_price == 0)
                    return scale(1).hex();
                ;
                return scale(Math.sqrt((d.properties.avg_price - 22700) / (96181 - 22700))).hex();
            })
            .style("opacity", 0.9)
            .attr("d", path)
            .on("click", district_clicked)
            .on("mouseover", function (d, i) {
                d3.select(this)
                    .style("opacity", 0.7);
                tooltip.html(d.properties.name + "<br>Price(价格):¥" + tomoney(d.properties.avg_price, 2).toLocaleString("en-us") + " /m<sup>2</sup><br>Cost(花费):" + d.properties.avg_price.toFixed(1) + " Month(月)/m<sup>2</sup>")
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY + 10) + "px")
                    .style("opacity", 1.0);
            }).on("mousemove", function (d) {
            tooltip.html(d.properties.name + "<br>Price(价格):¥" + tomoney(d.properties.avg_price, 2).toLocaleString("en-us") + " /m<sup>2</sup><br>Cost(花费):" + d.properties.avg_price.toFixed(1) + " Month(月)/m<sup>2</sup>")
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY + 10) + "px")

        })
            .on("mouseout", function (d, i) {
                tooltip.html("").style("opacity", 0.0);
                d3.select(this)
                    .style("opacity", 0.9);
            });

    });

    //Get coodinate for zoom in
    function get_xyz(d) {
        var bounds = path.bounds(d);
        var w_scale = (bounds[1][0] - bounds[0][0]) / width;
        var h_scale = (bounds[1][1] - bounds[0][1]) / height;
        var z = .9 / Math.max(w_scale, h_scale);
        var x = (bounds[1][0] + bounds[0][0]) / 2;
        var y = (bounds[1][1] + bounds[0][1]) / 2;
        return [x, y, z];
    }
    ;

    //Click action for district map

    function district_clicked(d) {
        if (district) {
            g.selectAll("#" + district.id).style('display', null);
        }
        if (d && district == null) {
            ;
            var xyz = get_xyz(d);
            district = d;
            zoom(xyz);
        } else {
            if (district != d) {
                var xyz = [width / 2, height / 2, 1];
                district = null;
                zoom(xyz);
            }
        }
    }
    ;
    //zoomin
    function zoom(xyz) {
        g.transition()
            .duration(750)
            .attr("transform", "translate(" + projection.translate() + ")scale(" + xyz[2] + ")translate(-" + xyz[0] + ",-" + xyz[1] + ")")
            .selectAll(["#countries", "#states", "#cities"])
            .style("stroke-width", 1.0 / xyz[2] + "px")
            .selectAll(".city")
            .attr("d", path.pointRadius(20.0 / xyz[2]));
    }
    ;
    //    -----------------------------------------------

</script>

</body>
</html>
